<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Full Automation Setup</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0;
        }

        .form-container {
            padding: 40px;
        }

        .service-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .service-card.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .service-card input[type="checkbox"] {
            position: absolute;
            top: 15px;
            right: 15px;
            transform: scale(1.2);
        }

        .service-card h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .service-card p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .service-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .form-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .form-section.hidden {
            display: none;
        }

        .form-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="url"],
        select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            transform: scale(1.2);
        }

        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .security-note {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .service-selector {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Full Automation Setup</h1>
            <p class="subtitle">Deploy complete client management automation across Supabase, Airtable, and n8n</p>
        </div>

        <div class="form-container">
            <div class="security-note">
                ‚ö†Ô∏è <strong>Security Note:</strong> This form handles sensitive API keys. Only use with trusted service providers and never share your credentials.
            </div>

            <form id="setupForm">
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>üìã Basic Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientName">Client Name *</label>
                            <input type="text" id="clientName" name="clientName" required placeholder="e.g., Acme Corporation">
                            <div class="help-text">Reference name for this setup</div>
                        </div>
                        <div class="form-group">
                            <label for="email">Contact Email *</label>
                            <input type="email" id="email" name="email" required placeholder="admin@acme.com">
                            <div class="help-text">Email for notifications and updates</div>
                        </div>
                    </div>
                </div>

                <!-- Service Selection -->
                <div class="form-section">
                    <h3>üîß Select Services to Setup</h3>
                    <div class="service-selector">
                        <div class="service-card" onclick="toggleService('supabase')">
                            <input type="checkbox" id="setupSupabase" checked>
                            <span class="service-icon">üóÑÔ∏è</span>
                            <h3>Supabase Database</h3>
                            <p>Complete database schema with tables for clients, projects, invoices, and time tracking</p>
                        </div>

                        <div class="service-card" onclick="toggleService('airtable')">
                            <input type="checkbox" id="setupAirtable">
                            <span class="service-icon">üìä</span>
                            <h3>Airtable Base</h3>
                            <p>Client management base with smart schema reconciliation and data preservation</p>
                        </div>

                        <div class="service-card" onclick="toggleService('n8n')">
                            <input type="checkbox" id="setupN8n">
                            <span class="service-icon">‚ö°</span>
                            <h3>n8n Workflows</h3>
                            <p>Automated workflows connecting your services with webhook integration</p>
                        </div>
                    </div>
                </div>

                <!-- Supabase Configuration -->
                <div class="form-section" id="supabaseSection">
                    <h3>üóÑÔ∏è Supabase Configuration</h3>
                    <div class="form-group">
                        <label for="supabaseUrl">Supabase Project URL *</label>
                        <input type="url" id="supabaseUrl" name="supabaseUrl" placeholder="https://xxxxx.supabase.co">
                        <div class="help-text">Your Supabase project URL from Settings ‚Üí API</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="supabaseKey">Service Role Key *</label>
                            <input type="password" id="supabaseKey" name="supabaseKey" placeholder="eyJhbGci...">
                            <div class="help-text">Service role key (starts with eyJhbGci)</div>
                        </div>
                        <div class="form-group">
                            <label for="databasePassword">Database Password *</label>
                            <input type="password" id="databasePassword" name="databasePassword" placeholder="Your secure password">
                            <div class="help-text">Password for database operations</div>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="vectorExtension" checked>
                        <label for="vectorExtension">Setup vector extension for AI features</label>
                    </div>
                </div>

                <!-- Airtable Configuration -->
                <div class="form-section hidden" id="airtableSection">
                    <h3>üìä Airtable Configuration</h3>
                    <div class="form-group">
                        <label for="airtableApiKey">Airtable API Key *</label>
                        <input type="password" id="airtableApiKey" name="airtableApiKey" placeholder="keyXXXXXXXXXXXXXX">
                        <div class="help-text">Your Airtable API key from Account ‚Üí API</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="airtableBaseId">Existing Base ID (Optional)</label>
                            <input type="text" id="airtableBaseId" name="airtableBaseId" placeholder="appXXXXXXXXXXXXXX">
                            <div class="help-text">Leave empty to create new base</div>
                        </div>
                        <div class="form-group">
                            <label for="airtableWorkspaceId">Workspace ID (For new bases)</label>
                            <input type="text" id="airtableWorkspaceId" name="airtableWorkspaceId" placeholder="wspXXXXXXXXXXXXXX">
                            <div class="help-text">Required only for creating new bases</div>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="airtableCreateNew">
                        <label for="airtableCreateNew">Force create new base (ignore existing base ID)</label>
                    </div>
                </div>

                <!-- n8n Configuration -->
                <div class="form-section hidden" id="n8nSection">
                    <h3>‚ö° n8n Configuration</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="n8nUrl">n8n Instance URL *</label>
                            <input type="url" id="n8nUrl" name="n8nUrl" placeholder="https://your-n8n.app.n8n.cloud">
                            <div class="help-text">Your n8n instance URL</div>
                        </div>
                        <div class="form-group">
                            <label for="n8nApiKey">n8n API Key *</label>
                            <input type="password" id="n8nApiKey" name="n8nApiKey" placeholder="n8n_api_XXXXXXXXXX">
                            <div class="help-text">API key from n8n Settings ‚Üí API</div>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="n8nActivateWorkflows" checked>
                        <label for="n8nActivateWorkflows">Activate workflows after deployment</label>
                    </div>
                </div>

                <!-- General Options -->
                <div class="form-section">
                    <h3>‚öôÔ∏è General Options</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="dryRun" checked>
                        <label for="dryRun"><strong>Dry Run Mode</strong> - Validate configuration without making changes</label>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="testConnections()">Test Connections</button>
                    <button type="submit" class="btn-primary">Deploy Automation</button>
                </div>

                <div id="status" class="status"></div>
            </form>
        </div>
    </div>

    <script>
        const API_ENDPOINT = '/api/setup-handler';

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = message;
            statusEl.style.display = 'block';
        }

        function toggleService(service) {
            const checkbox = document.getElementById(`setup${service.charAt(0).toUpperCase() + service.slice(1)}`);
            const section = document.getElementById(`${service}Section`);
            const card = checkbox.closest('.service-card');

            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                section.classList.remove('hidden');
                card.classList.add('selected');
            } else {
                section.classList.add('hidden');
                card.classList.remove('selected');
            }
        }

        async function testConnections() {
            const services = [];

            if (document.getElementById('setupSupabase').checked) {
                services.push('Supabase');
            }
            if (document.getElementById('setupAirtable').checked) {
                services.push('Airtable');
            }
            if (document.getElementById('setupN8n').checked) {
                services.push('n8n');
            }

            if (services.length === 0) {
                showStatus('‚ùå Please select at least one service to test', 'error');
                return;
            }

            showStatus(`üîç Testing connections to ${services.join(', ')}... <span class="loading"></span>`, 'info');

            // Simulate connection testing
            setTimeout(() => {
                showStatus(`‚úÖ Connection test completed for ${services.join(', ')}!`, 'success');
            }, 2000);
        }

        document.getElementById('setupForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                clientName: document.getElementById('clientName').value,
                email: document.getElementById('email').value,

                // Service selections
                setupSupabase: document.getElementById('setupSupabase').checked,
                setupAirtable: document.getElementById('setupAirtable').checked,
                setupN8n: document.getElementById('setupN8n').checked,

                // Supabase fields
                supabaseUrl: document.getElementById('supabaseUrl').value,
                supabaseKey: document.getElementById('supabaseKey').value,
                databasePassword: document.getElementById('databasePassword').value,
                vectorExtension: document.getElementById('vectorExtension').checked,

                // Airtable fields
                airtableApiKey: document.getElementById('airtableApiKey').value,
                airtableBaseId: document.getElementById('airtableBaseId').value,
                airtableWorkspaceId: document.getElementById('airtableWorkspaceId').value,
                airtableCreateNew: document.getElementById('airtableCreateNew').checked,

                // n8n fields
                n8nUrl: document.getElementById('n8nUrl').value,
                n8nApiKey: document.getElementById('n8nApiKey').value,
                n8nActivateWorkflows: document.getElementById('n8nActivateWorkflows').checked,

                // General options
                dryRun: document.getElementById('dryRun').checked
            };

            const selectedServices = [];
            if (formData.setupSupabase) selectedServices.push('Supabase');
            if (formData.setupAirtable) selectedServices.push('Airtable');
            if (formData.setupN8n) selectedServices.push('n8n');

            if (selectedServices.length === 0) {
                showStatus('‚ùå Please select at least one service to setup', 'error');
                return;
            }

            showStatus(`üöÄ Deploying automation for ${selectedServices.join(', ')}... <span class="loading"></span>`, 'info');

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus(`‚úÖ ${result.message}<br><br>
                        üÜî Run ID: <strong>${result.runId}</strong><br>
                        üîó <a href="${result.workflowUrl}" target="_blank">View Progress</a><br><br>
                        ${result.note}`, 'success');
                } else {
                    showStatus(`‚ùå Setup failed: ${result.error}${result.details ? '<br>Details: ' + result.details : ''}`, 'error');
                }

            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        });

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial state
            document.getElementById('supabaseSection').classList.remove('hidden');
            document.querySelector('.service-card').classList.add('selected');
        });
    </script>
</body>
</html>